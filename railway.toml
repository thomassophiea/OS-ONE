# Railway Configuration
# Last Update: 2026-01-31 - EP1 Theme
[build]
builder = "nixpacks"

[build.nixpacksPlan]
phases.setup.nixPkgs = ["nodejs", "git"]
phases.install.cmds = [
  "npm ci --no-cache",
  "echo 'Dependencies installed at:' $(date -u)"
]
phases.build.cmds = [
  "rm -rf node_modules/.vite build dist .cache",
  "echo 'Running version generator...'",
  "node scripts/generate-version.js || echo 'Version script fallback triggered'",
  "echo 'Running Vite build...'",
  "npx vite build",
  "echo 'Build output:'",
  "ls -la build/",
  "ls -la build/assets/ | head -10",
  "echo 'Build completed at:' $(date -u)"
]

[deploy]
startCommand = "node server.js"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10
