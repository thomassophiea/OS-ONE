import{j as e}from"./vendor-ui-CO0mBmim.js";import{a as r}from"./vendor-react-BQC692LR.js";import{a as x,w as t,t as V,C as n,b as d,c as o,d as m,h as y,L as b,m as te,n as ie,o as ce,p as ne,q as de,e as R,B as i,I as B}from"./index-CrdvL8SR.js";import{C as oe}from"./checkbox-DKtTTixp.js";import{D as L,a as I,b as M,c as O,d as E,e as W}from"./dialog-BqYeg193.js";import{D as me,T as xe}from"./MobileOptimized-BTJ5PvfS.js";import{b as C,R as H,W as q,a3 as he,x as X,v as ue,a6 as A,a1 as je,y as pe}from"./vendor-icons-DmoIqCnf.js";import"./vendor-charts-CCS-1Xlq.js";function Ce(){const[h,$]=r.useState([]),[D,G]=r.useState([]),[U,J]=r.useState([]),[l,u]=r.useState(new Set),[c,K]=r.useState(""),[Q,k]=r.useState(!0),[P,F]=r.useState(!1),[Y,p]=r.useState(!1),[Z,g]=r.useState(!1),[w,T]=r.useState(""),[N,z]=r.useState("");r.useEffect(()=>{j()},[]);const j=async()=>{k(!0);try{const[s,a,S]=await Promise.all([x.getAccessPoints(),x.getAPSoftwareVersions(),x.getAPUpgradeSchedules()]);$(s),G(a),J(S)}catch(s){console.error("Failed to load data:",s),t.error("Failed to load firmware data")}finally{k(!1)}},_=s=>{const a=new Set(l);a.has(s)?a.delete(s):a.add(s),u(a)},ee=()=>{u(new Set(h.map(s=>s.serialNumber)))},se=()=>{u(new Set)},ae=async()=>{if(l.size===0){t.error("Please select at least one access point");return}if(!c){t.error("Please select a firmware version");return}F(!0);try{await x.upgradeAPSoftware(Array.from(l),c),t.success(`Firmware upgrade initiated for ${l.size} access point(s)`),p(!1),u(new Set),await j()}catch(s){console.error("Failed to upgrade firmware:",s),t.error("Failed to initiate firmware upgrade")}finally{F(!1)}},le=async()=>{if(l.size===0){t.error("Please select at least one access point");return}if(!c||!w||!N){t.error("Please fill in all fields");return}try{await x.createAPUpgradeSchedule({name:w,targetVersion:c,scheduledTime:new Date(N).toISOString(),deviceSerialNumbers:Array.from(l)}),t.success("Upgrade scheduled successfully"),g(!1),T(""),z(""),u(new Set),await j()}catch(s){console.error("Failed to schedule upgrade:",s),t.error("Failed to schedule firmware upgrade")}},re=async s=>{if(confirm("Are you sure you want to delete this schedule?"))try{await x.deleteAPUpgradeSchedule(s),t.success("Schedule deleted successfully"),await j()}catch(a){console.error("Failed to delete schedule:",a),t.error("Failed to delete schedule")}},v=s=>{const a=D.find(S=>S.isRecommended);return a?s.currentFirmware===a.version?{status:"up-to-date",color:"green"}:{status:"update-available",color:"yellow"}:{status:"unknown",color:"gray"}},f={total:h.length,upToDate:h.filter(s=>v(s).status==="up-to-date").length,updateAvailable:h.filter(s=>v(s).status==="update-available").length,selected:l.size};return Q?e.jsxs("div",{className:"space-y-4 p-6",children:[e.jsx(V,{className:"h-8 w-64"}),e.jsx(V,{className:"h-96 w-full"})]}):e.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl md:text-3xl font-bold flex items-center gap-2",children:[e.jsx(C,{className:"h-6 w-6 md:h-8 md:w-8"}),"AP Firmware Management"]}),e.jsx(me,{children:e.jsx("p",{className:"text-muted-foreground",children:"Manage access point firmware upgrades and schedules"})})]}),e.jsxs(xe,{variant:"outline",size:"sm",onClick:j,"aria-label":"Refresh AP firmware data",children:[e.jsx(H,{className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Refresh"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(n,{children:[e.jsx(d,{className:"pb-3",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Total APs"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-2xl font-bold",children:f.total})]})})]}),e.jsxs(n,{children:[e.jsx(d,{className:"pb-3",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Up to Date"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-2xl font-bold",children:f.upToDate})]})})]}),e.jsxs(n,{children:[e.jsx(d,{className:"pb-3",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Updates Available"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-2xl font-bold",children:f.updateAvailable})]})})]}),e.jsxs(n,{children:[e.jsx(d,{className:"pb-3",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Selected"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-2xl font-bold",children:f.selected})]})})]})]}),e.jsxs(n,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Firmware Selection & Actions"}),e.jsx(y,{children:"Select firmware version and access points to upgrade"})]}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Target Firmware Version"}),e.jsxs(te,{value:c,onValueChange:K,children:[e.jsx(ie,{children:e.jsx(ce,{placeholder:"Select firmware version"})}),e.jsx(ne,{children:D.map(s=>e.jsx(de,{value:s.version,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.version}),s.isRecommended&&e.jsx(R,{className:"bg-green-500",children:"Recommended"})]})},s.version))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{onClick:()=>p(!0),disabled:l.size===0||!c,children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Upgrade Now (",l.size," APs)"]}),e.jsxs(i,{variant:"outline",onClick:()=>g(!0),disabled:l.size===0||!c,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Schedule Upgrade"]})]})]})]}),e.jsxs(n,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Access Points"}),e.jsx(y,{children:"Select access points to upgrade"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:ee,"aria-label":"Select all access points",children:"Select All"}),e.jsx(i,{variant:"outline",size:"sm",onClick:se,"aria-label":"Deselect all access points",children:"Deselect All"})]})]})}),e.jsx(m,{children:e.jsx("div",{className:"space-y-2",children:h.map(s=>{const a=v(s);return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{checked:l.has(s.serialNumber),onCheckedChange:()=>_(s.serialNumber)}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.displayName||s.serialNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.model})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium",children:["v",s.currentFirmware||"Unknown"]}),e.jsx(R,{variant:a.status==="up-to-date"?"default":"outline",className:a.color==="green"?"bg-green-500":a.color==="yellow"?"bg-yellow-500":"",children:a.status==="up-to-date"?"Up to Date":"Update Available"})]})})]},s.serialNumber)})})})]}),U.length>0&&e.jsxs(n,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Scheduled Upgrades"}),e.jsx(y,{children:"Upcoming firmware upgrade schedules"})]}),e.jsx(m,{children:e.jsx("div",{className:"space-y-2",children:U.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(je,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(s.scheduledTime).toLocaleString()})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium",children:["v",s.targetVersion]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.deviceCount," device(s)"]})]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>re(s.id),children:e.jsx(pe,{className:"h-4 w-4 text-destructive"})})]})]},s.id))})})]}),e.jsx(L,{open:Y,onOpenChange:p,children:e.jsxs(I,{children:[e.jsxs(M,{children:[e.jsx(O,{children:"Confirm Firmware Upgrade"}),e.jsxs(E,{children:["This will immediately upgrade ",l.size," access point(s) to version"," ",c]})]}),e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md",children:[e.jsx(X,{className:"h-4 w-4 text-yellow-600"}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"Access points will reboot during the upgrade process"})]})}),e.jsxs(W,{children:[e.jsx(i,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(i,{onClick:ae,disabled:P,children:P?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Upgrading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Start Upgrade"]})})]})]})}),e.jsx(L,{open:Z,onOpenChange:g,children:e.jsxs(I,{children:[e.jsxs(M,{children:[e.jsx(O,{children:"Schedule Firmware Upgrade"}),e.jsxs(E,{children:["Schedule an upgrade for ",l.size," access point(s)"]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Schedule Name"}),e.jsx(B,{value:w,onChange:s=>T(s.target.value),placeholder:"e.g., Weekly Maintenance Upgrade"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Scheduled Time"}),e.jsx(B,{type:"datetime-local",value:N,onChange:s=>z(s.target.value)})]})]}),e.jsxs(W,{children:[e.jsx(i,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsxs(i,{onClick:le,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Create Schedule"]})]})]})})]})}export{Ce as APFirmwareManager};
