import{j as e}from"./vendor-ui-CO0mBmim.js";import{a as i}from"./vendor-react-BQC692LR.js";import{a as A,w as d,t as E,C as T,b as G,c as M,h as $,d as B,L as I,m as U,n as q,o as z,p as O,q as S,e as m,I as te,B as N,v as j}from"./index-CrdvL8SR.js";import{S as ae,M as ne,W as le,A as re,al as de,bB as ie,b as ce,a3 as oe,J as me,y as xe}from"./vendor-icons-DmoIqCnf.js";import"./vendor-charts-CCS-1Xlq.js";function ge(){const[w,H]=i.useState([]),[g,x]=i.useState([]),[J,y]=i.useState(!0),[P,C]=i.useState(!1),[L,D]=i.useState(!1),[a,h]=i.useState({siteId:"",wlanId:"",vlanIds:[],includeDisconnectedAPs:!0}),[R,W]=i.useState(""),[r,K]=i.useState(null),f=i.useRef(null);i.useEffect(()=>{X()},[]),i.useEffect(()=>{a.siteId?Y(a.siteId):(x([]),h(s=>({...s,wlanId:""})))},[a.siteId]);const X=async()=>{y(!0);try{const s=await A.getSites();H(s)}catch(s){console.error("Failed to load sites:",s),d.error("Failed to load sites")}finally{y(!1)}},Y=async s=>{C(!0),console.log(`[PCIReport] Loading WLANs for site: ${s}`);try{const l=await A.makeAuthenticatedRequest("/v1/services",{},1e4);if(!l.ok){console.error(`[PCIReport] Services API returned ${l.status}`),d.error(`Failed to load WLANs: API returned ${l.status}`),x([]);return}const c=await l.json();if(console.log("[PCIReport] Raw services from API:",c),!c||!Array.isArray(c)||c.length===0){console.log("[PCIReport] No services returned from API"),x([]),d.info("No WLANs/Services configured on Extreme Platform ONE");return}const u=c.map(n=>{const p=n.ssid||n.serviceName||n.name||"";return console.log("[PCIReport] Service:",{id:n.id,ssid:p,serviceName:n.serviceName,name:n.name}),{id:n.id,ssid:p,name:n.name||n.serviceName,serviceName:n.serviceName,vlan:n.vlan||n.dot1dPortNumber,enabled:n.enabled!==!1&&n.status!=="disabled"}}).filter(n=>n.id&&n.ssid);console.log(`[PCIReport] Processed ${u.length} WLANs:`,u),x(u),u.length===0&&d.info("No WLANs found with valid SSID.")}catch(l){console.error("[PCIReport] Failed to load WLANs:",l),d.error("Failed to load WLANs - check console for details"),x([])}finally{C(!1)}},k=()=>{const s=parseInt(R);if(isNaN(s)||s<1||s>4094){d.error("Please enter a valid VLAN ID (1-4094)");return}if(a.vlanIds.includes(s)){d.error("VLAN ID already added");return}h(l=>({...l,vlanIds:[...l.vlanIds,s]})),W("")},_=s=>{h(l=>({...l,vlanIds:l.vlanIds.filter(c=>c!==s)}))},Q=async()=>{if(!a.siteId||!a.wlanId){d.error("Please select a site and WLAN");return}if(a.vlanIds.length===0){d.error("Please add at least one VLAN ID");return}D(!0);try{const s=w.find(t=>t.id===a.siteId),l=g.find(t=>t.id===a.wlanId);if(!s)throw new Error("Site not found");if(!l)throw new Error("WLAN not found. Please select a valid WLAN.");const n=(await A.getAccessPoints()).filter(t=>{const o=t.siteId||t.site||t.hostSite,v=s.displayName||s.name||s.siteName;return o===a.siteId||o===v}).map(t=>{const o=(t.status||t.connectionState||t.operationalState||t.state||"").toLowerCase(),v=o==="inservice"||o.includes("up")||o.includes("online")||o.includes("connected")||t.isUp===!0||t.online===!0;return{id:t.serialNumber||t.id||t.macAddress,name:t.apName||t.displayName||t.name||t.macAddress||"Unknown AP",mac:t.macAddress||t.mac||"Unknown",status:v?"connected":"disconnected",siteId:a.siteId}}),p=n.filter(t=>t.status==="connected"),b=n.filter(t=>t.status!=="connected");let V="pass";b.length>0&&(V=b.length>p.length?"fail":"warning");const se={siteId:a.siteId,siteName:s.displayName||s.name||s.siteName||"Unknown Site",wlanId:a.wlanId,wlanSsid:l.ssid,vlanIds:a.vlanIds,generatedAt:new Date().toISOString(),connectedAPs:p,disconnectedAPs:b,totalAPs:n.length,complianceStatus:V};K(se),d.success("PCI report generated successfully")}catch(s){console.error("Failed to generate report:",s),d.error("Failed to generate report")}finally{D(!1)}},F=()=>{if(!f.current)return;const s=window.open("","_blank");if(!s){d.error("Failed to open print window. Please allow popups.");return}s.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>PCI DSS Compliance Report - ${r?.siteName}</title>
        
      <style>
        @media print {
          body { margin: 0; padding: 20px; font-family: system-ui, -apple-system, sans-serif; }
          .no-print { display: none; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          th { background-color: #f3f4f6; font-weight: 600; }
          .header { margin-bottom: 20px; }
          .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
          .badge-success { background-color: #dcfce7; color: #166534; }
          .badge-warning { background-color: #fef3c7; color: #92400e; }
          .badge-error { background-color: #fee2e2; color: #991b1b; }
          .status-connected { color: #16a34a; }
          .status-disconnected { color: #dc2626; }
        }
      </style>
    
      </head>
      <body>
        ${f.current.innerHTML}
      </body>
      </html>
    `),s.document.close(),s.focus(),setTimeout(()=>{s.print(),s.close()},250)},Z=()=>{F(),d.info(`Use your browser's "Save as PDF" option in the print dialog`)},ee=s=>s.displayName||s.name||s.siteName||s.id;return J?e.jsxs("div",{className:"space-y-4 p-6",children:[e.jsx(E,{className:"h-8 w-64"}),e.jsx(E,{className:"h-96 w-full"})]}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ae,{className:"h-6 w-6"}),"PCI DSS Compliance Report"]}),e.jsx("p",{className:"text-muted-foreground",children:"Generate compliance documentation for Payment Card Industry Data Security Standard"})]}),e.jsxs(T,{children:[e.jsxs(G,{children:[e.jsx(M,{children:"Report Configuration"}),e.jsx($,{children:"Select site, WLAN, and VLANs transmitting cardholder data"})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Site"}),e.jsxs(U,{value:a.siteId,onValueChange:s=>h(l=>({...l,siteId:s})),children:[e.jsx(q,{children:e.jsx(z,{placeholder:"Select a site..."})}),e.jsx(O,{children:w.map(s=>e.jsx(S,{value:s.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),ee(s)]})},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"WLAN (Transmitting Cardholder Data)"}),e.jsxs(U,{value:a.wlanId,onValueChange:s=>h(l=>({...l,wlanId:s})),disabled:!a.siteId||P,children:[e.jsx(q,{children:e.jsx(z,{placeholder:P?"Loading WLANs...":"Select a WLAN..."})}),e.jsx(O,{children:g.length===0?e.jsx(S,{value:"none",disabled:!0,children:"No WLANs available"}):g.map(s=>e.jsx(S,{value:s.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:s.ssid}),s.name&&s.name!==s.ssid&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["(",s.name,")"]}),s.vlan&&e.jsxs(m,{variant:"outline",children:["VLAN ",s.vlan]})]})},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"VLAN IDs (Cardholder Data)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{type:"number",value:R,onChange:s=>W(s.target.value),onKeyPress:s=>s.key==="Enter"&&k(),placeholder:"Enter VLAN ID (1-4094)",min:"1",max:"4094"}),e.jsx(N,{onClick:k,variant:"outline",children:"Add"})]}),a.vlanIds.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:a.vlanIds.map(s=>e.jsxs(m,{variant:"secondary",className:"gap-1",children:["VLAN ",s,e.jsx("button",{onClick:()=>_(s),className:"ml-1 hover:text-destructive",children:"Ã—"})]},s))})]}),e.jsx(N,{onClick:Q,disabled:!a.siteId||!a.wlanId||a.vlanIds.length===0||L,className:"w-full",children:L?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating Report..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Generate Report"]})})]})]}),r&&e.jsxs(T,{children:[e.jsx(G,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"PCI DSS Compliance Report"}),e.jsxs($,{children:["Generated on ",new Date(r.generatedAt).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 no-print",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:F,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Print"]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:Z,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Export PDF"]})]})]})}),e.jsx(B,{children:e.jsxs("div",{ref:f,className:"space-y-6",children:[e.jsxs("div",{className:"header",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"PCI DSS Compliance Report"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Site:"}),e.jsx("span",{className:"ml-2 font-medium",children:r.siteName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"WLAN:"}),e.jsx("span",{className:"ml-2 font-medium",children:r.wlanSsid})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"VLAN IDs:"}),e.jsx("span",{className:"ml-2 font-medium",children:r.vlanIds.join(", ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Generated:"}),e.jsx("span",{className:"ml-2 font-medium",children:new Date(r.generatedAt).toLocaleString()})]})]})]}),e.jsx(j,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Compliance Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.complianceStatus==="pass"&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-5 w-5 text-green-600"}),e.jsx(m,{className:"bg-green-500 badge badge-success",children:"PASS"}),e.jsx("span",{className:"text-sm",children:"All access points are connected"})]}),r.complianceStatus==="warning"&&e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-5 w-5 text-yellow-600"}),e.jsx(m,{className:"bg-yellow-500 badge badge-warning",children:"WARNING"}),e.jsx("span",{className:"text-sm",children:"Some access points are disconnected"})]}),r.complianceStatus==="fail"&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-5 w-5 text-red-600"}),e.jsx(m,{className:"bg-red-500 badge badge-error",children:"FAIL"}),e.jsx("span",{className:"text-sm",children:"Majority of access points are disconnected"})]})]})]}),e.jsx(j,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold",children:r.totalAPs}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total APs"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.connectedAPs.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Connected"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.disconnectedAPs.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Disconnected"})]})]})]}),e.jsx(j,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Connected Access Points"}),r.connectedAPs.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No connected access points found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"MAC Address"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Status"})]})}),e.jsx("tbody",{children:r.connectedAPs.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2 font-mono text-sm",children:s.mac}),e.jsx("td",{className:"p-2",children:e.jsx(m,{className:"bg-green-500 status-connected",children:"Connected"})})]},s.id))})]})})]}),r.disconnectedAPs.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(j,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-red-600",children:"Appendix: Disconnected Access Points"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"The following access points are not in a connected state and require attention:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"MAC Address"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Status"})]})}),e.jsx("tbody",{children:r.disconnectedAPs.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2 font-mono text-sm",children:s.mac}),e.jsx("td",{className:"p-2",children:e.jsx(m,{className:"bg-red-500 status-disconnected",children:"Disconnected"})})]},s.id))})]})})]})]}),e.jsx(j,{}),e.jsx("div",{className:"text-xs text-muted-foreground",children:e.jsx("p",{children:"This report was automatically generated by the Network Management System. For PCI DSS compliance requirements, ensure all access points are in a connected state and transmitting on the designated VLANs for cardholder data."})})]})})]})]})}export{ge as PCIReport};
