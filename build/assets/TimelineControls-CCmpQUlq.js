import{a as n}from"./vendor-react-BQC692LR.js";import{j as t}from"./vendor-ui-CO0mBmim.js";import{B as k,e as v}from"./index-CrdvL8SR.js";import{b1 as p,b2 as S,I as y,a2 as W,X as L}from"./vendor-icons-DmoIqCnf.js";const C={"client-insights":{currentTime:null,timeWindow:{start:null,end:null},isLocked:!1},"ap-insights":{currentTime:null,timeWindow:{start:null,end:null},isLocked:!1}},N={"client-insights":new Set,"ap-insights":new Set};function T(e){N[e].forEach(s=>s())}function d(e){return C[e]}function a(e,s){C[e]={...C[e],...s},T(e)}function E(e){const[s,m]=n.useState(()=>d(e)),l=n.useRef(null),u=n.useRef(!1);n.useEffect(()=>{const i=()=>{m(d(e))};return N[e].add(i),()=>{N[e].delete(i)}},[e]);const f=n.useCallback(i=>{l.current!==null&&cancelAnimationFrame(l.current),l.current=requestAnimationFrame(()=>{d(e).isLocked||a(e,{currentTime:i}),l.current=null})},[e]),g=n.useCallback(()=>{const i=d(e);a(e,{isLocked:!i.isLocked})},[e]),h=n.useCallback(i=>{u.current=!0,a(e,{timeWindow:{start:i,end:i}})},[e]),w=n.useCallback(i=>{if(u.current){const c=d(e);c.timeWindow.start!==null&&a(e,{timeWindow:{...c.timeWindow,end:i}})}},[e]),j=n.useCallback(()=>{u.current=!1},[]),b=n.useCallback(()=>{a(e,{timeWindow:{start:null,end:null}})},[e]),r=n.useCallback(()=>{a(e,{currentTime:null,timeWindow:{start:null,end:null},isLocked:!1})},[e]),x=n.useCallback(()=>{a(e,{timeWindow:{start:null,end:null}})},[e]),o=n.useCallback(i=>{const c=d(i);a(e,{currentTime:c.currentTime,timeWindow:c.timeWindow,isLocked:c.isLocked})},[e]);return n.useEffect(()=>()=>{l.current!==null&&cancelAnimationFrame(l.current)},[]),{currentTime:s.currentTime,timeWindow:s.timeWindow,isLocked:s.isLocked,setCurrentTime:f,toggleLock:g,startTimeWindow:h,updateTimeWindow:w,endTimeWindow:j,clearTimeWindow:b,resetTimeline:r,softReset:x,syncFromScope:o}}function z({currentTime:e,isLocked:s,hasTimeWindow:m,onToggleLock:l,onClearTimeWindow:u,onCopyTimeline:f,sourceLabel:g}){const[h,w]=n.useState(!1),j=r=>r===null?"No time selected":new Date(r).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit"}),b=(r,x)=>{if(r===null||x===null)return"";const o=Math.abs(x-r)/1e3;return o<60?`${o.toFixed(0)}s`:o<3600?`${(o/60).toFixed(1)}m`:`${(o/3600).toFixed(1)}h`};return t.jsxs("div",{className:"flex flex-col border-b border-border",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-muted/30",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"text-sm min-w-[180px]",children:[t.jsx("span",{className:"text-muted-foreground",children:"Time: "}),t.jsx("span",{className:"font-medium",children:j(e)})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[s?t.jsxs(k,{variant:"default",size:"sm",onClick:l,className:"gap-2 bg-violet-600 hover:bg-violet-700 text-white shadow-md font-semibold",title:"Click to unlock (or click on any chart)",children:[t.jsx(p,{className:"h-4 w-4"}),"Locked"]}):t.jsxs(v,{variant:"secondary",className:"gap-1.5 px-2 py-1.5 flex items-center",children:[t.jsx(S,{className:"h-3.5 w-3.5"}),t.jsx("span",{className:"font-medium",children:e===null?"Unlocked":"Tracking"})]}),m&&t.jsxs(v,{variant:"outline",className:"text-xs px-2 py-1",children:["Window: ",b(e,e)]})]}),t.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>w(!h),className:"gap-2",title:"Show timeline help",children:[t.jsx(y,{className:"h-4 w-4"}),h?"Hide":"Help"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[f&&(e!==null||m)&&t.jsxs(k,{variant:"outline",size:"sm",onClick:f,className:"gap-2",title:`Copy this timeline to ${g||"other insights"}`,children:[t.jsx(W,{className:"h-4 w-4"}),"Copy to ",g||"Other"]}),m&&t.jsxs(k,{variant:"ghost",size:"sm",onClick:u,className:"gap-2",title:"Clear time window selection",children:[t.jsx(L,{className:"h-4 w-4"}),"Clear Selection"]}),t.jsxs("div",{className:"text-xs text-muted-foreground font-medium",children:[s&&"üîí Locked - Click chart or button to unlock",!s&&e===null&&"üí° Hover chart to preview time",!s&&e!==null&&"üëÜ Click chart to lock at this time"]})]})]}),h&&t.jsx("div",{className:"px-4 py-3 bg-blue-500/5 border-t border-blue-500/20",children:t.jsxs("div",{className:"text-sm space-y-2",children:[t.jsx("div",{className:"font-semibold text-blue-600 dark:text-blue-400",children:"‚è±Ô∏è Timeline Navigation Guide"}),t.jsxs("ul",{className:"space-y-1.5 text-xs text-muted-foreground ml-4",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Hover:"})," Move mouse over any chart to preview time - reference line appears across all charts"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"üéØ Click to Lock:"})," Click directly on any chart to lock the timeline at that exact moment (click again to unlock)"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Time Range Selection:"})," Hold ",t.jsx("kbd",{className:"px-1.5 py-0.5 bg-muted border rounded text-xs font-mono",children:"Shift"})," + drag across chart to highlight a time window"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Copy Timeline:"}),' Lock a time, then click "Copy to..." to sync this exact moment to the other insights page']}),t.jsxs("li",{children:[t.jsx("strong",{children:"Correlation Workflow:"})," See a spike in Client Insights ‚Üí Click to lock ‚Üí Copy to AP Insights ‚Üí See what AP was doing at same time!"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Clear Selection:"}),' Click "Clear Selection" button to remove time window highlights']})]})]})})]})}export{z as T,E as u};
