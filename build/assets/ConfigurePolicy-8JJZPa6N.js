import{j as e}from"./vendor-ui-CO0mBmim.js";import{a as r}from"./vendor-react-BQC692LR.js";import{a as $,T as Le,i as ke,j as Q,k as Y,L as l,I as m,m as V,n as H,o as M,p as G,q as o,e as x,B as p,C as w,w as f}from"./index-CrdvL8SR.js";import{D as Pe,a as Ue,b as Oe,c as Ve,d as He,e as Me}from"./dialog-BqYeg193.js";import{S as Te}from"./switch-iy-vimzq.js";import{T as qe}from"./textarea-PnFczYiL.js";import{aX as Xe,S as te,R as re,k as Ge,N as le,a_ as je,Z as Je,b1 as J,b2 as $e,ac as fe,a0 as ge,P as Ie,J as es}from"./vendor-icons-DmoIqCnf.js";import"./vendor-charts-CCS-1Xlq.js";function Ee({role:t,isOpen:u,onClose:A,onSave:ee,isInline:g=!1}){const j=!!t,[n,se]=r.useState(!1),[h,R]=r.useState(!1),[ce,ae]=r.useState("basic"),[F,_]=r.useState({x:0,y:0}),[N,D]=r.useState(!1),[v,B]=r.useState({x:0,y:0}),b=r.useRef(null);r.useEffect(()=>{console.log("ðŸ”§ RoleEditDialog render - isOpen:",u,"isEditing:",j)},[u,j]);const[y,T]=r.useState([]),[I,ne]=r.useState([]),[E,z]=r.useState(""),[L,K]=r.useState("allow"),[k,C]=r.useState(null),[P,s]=r.useState(null),[d,W]=r.useState(""),[Ne,ie]=r.useState(""),[ve,de]=r.useState(""),[ye,oe]=r.useState(!1),[we,me]=r.useState(!1),[be,Ce]=r.useState([80,443]),[Se,Ae]=r.useState(["CENTRALIZED-SITE"]),[xe,pe]=r.useState([]),[U,Z]=r.useState([]),[O,q]=r.useState([]);r.useEffect(()=>{u&&(_({x:0,y:0}),Qe(),t?(z(t.name||""),K(t.defaultAction==="deny"?"deny":"allow"),C(t.topology),s(t.defaultCos),W(t.cpRedirect||""),ie(t.cpIdentity||""),de(t.cpSharedKey||""),oe(t.cpHttp||!1),me(t.cpUseFQDN||!1),Ce(t.cpRedirectPorts||[80,443]),Ae(t.features||["CENTRALIZED-SITE"]),pe(t.profiles||[]),Z(t.l3Filters||[]),q(t.l7Filters||[])):ue())},[t,u]);const Qe=async()=>{R(!0);try{const[a,c]=await Promise.all([$.getClassOfService().catch(i=>(console.log("CoS data unavailable, using manual input:",i.message),[])),$.getTopologies().catch(i=>(console.log("Topology data unavailable, using manual input:",i.message),[]))]);T(a),ne(c),a.length>0||c.length>0?console.log(`âœ“ Loaded ${a.length} CoS options and ${c.length} topologies`):console.log("âš ï¸ Reference data unavailable - using manual ID entry for CoS and Topology")}catch(a){console.warn("Error loading reference data:",a)}finally{R(!1)}},ue=()=>{z(""),K("allow"),C(null),s(null),W(""),ie(""),de(""),oe(!1),me(!1),Ce([80,443]),Ae(["CENTRALIZED-SITE"]),pe([]),Z([]),q([]),ae("basic")},Ye=async()=>{if(!E.trim()){f.error("Validation Error",{description:"Role name is required"});return}const a={name:E.trim(),defaultAction:L,topology:k,defaultCos:P,cpRedirect:d.trim(),cpIdentity:Ne.trim(),cpSharedKey:ve.trim(),cpHttp:ye,cpUseFQDN:we,cpRedirectPorts:be,features:Se,profiles:xe,l3Filters:U,l7Filters:O,l2Filters:t?.l2Filters||[],l3SrcDestFilters:t?.l3SrcDestFilters||[],cpTopologyId:t?.cpTopologyId||null,cpDefaultRedirectUrl:t?.cpDefaultRedirectUrl||"",cpRedirectUrlSelect:t?.cpRedirectUrlSelect||"URLTARGET",cpAddIpAndPort:t?.cpAddIpAndPort??!0,cpAddApNameAndSerial:t?.cpAddApNameAndSerial??!0,cpAddBssid:t?.cpAddBssid??!0,cpAddVnsName:t?.cpAddVnsName??!0,cpAddSsid:t?.cpAddSsid??!0,cpAddMac:t?.cpAddMac??!0,cpAddRole:t?.cpAddRole??!0,cpAddVlan:t?.cpAddVlan??!0,cpAddTime:t?.cpAddTime??!0,cpAddSign:t?.cpAddSign??!0,cpOauthUseGoogle:t?.cpOauthUseGoogle||!1,cpOauthUseFacebook:t?.cpOauthUseFacebook||!1,cpOauthUseMicrosoft:t?.cpOauthUseMicrosoft||!1};t&&(a.id=t.id,a.canEdit=t.canEdit,a.canDelete=t.canDelete,a.predefined=t.predefined),se(!0);try{await ee(a),ue(),A()}catch(c){console.error("Error saving role:",c)}finally{se(!1)}},_e=a=>{a.target.closest("[data-drag-handle]")&&(D(!0),B({x:a.clientX-F.x,y:a.clientY-F.y}))};r.useEffect(()=>{const a=i=>{N&&_({x:i.clientX-v.x,y:i.clientY-v.y})},c=()=>{D(!1)};if(N)return document.addEventListener("mousemove",a),document.addEventListener("mouseup",c),()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",c)}},[N,v]);const Re=()=>{ue(),A()},Be=()=>{Z([...U,{name:"",intoNetwork:"destAddr",outFromNetwork:"sourceAddr",action:"FILTERACTION_ALLOW",topologyId:null,cosId:null,subnetType:"anyIpAddress",ipAddressRange:"0.0.0.0/0",port:"any",portLow:0,portHigh:0,protocol:"any",protocolNumber:0,tosDscp:null,mask:null}])},ze=a=>{Z(U.filter((c,i)=>i!==a))},X=(a,c,i)=>{const S=[...U];S[a]={...S[a],[c]:i},Z(S)},Ke=()=>{q([...O,{name:"",intoNetwork:"destAddr",outFromNetwork:"destAddr",action:"FILTERACTION_DENY",topologyId:null,cosId:null,applicationId:0,appGroupId:0,appDisplayId:0}])},We=a=>{q(O.filter((c,i)=>i!==a))},he=(a,c,i)=>{const S=[...O];S[a]={...S[a],[c]:i},q(S)};console.log("ðŸ”§ RoleEditDialog rendering - isOpen:",u,"role:",t?.name||"NEW");const Fe=()=>e.jsx("div",{className:g?"space-y-4":"flex-1 overflow-y-auto hide-scrollbar px-6 py-6",children:e.jsxs(Le,{value:ce,onValueChange:ae,className:"w-full",children:[e.jsxs(ke,{className:"grid w-full grid-cols-4",children:[e.jsxs(Q,{value:"basic",className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Basic"]}),e.jsxs(Q,{value:"firewall",className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Firewall"]}),e.jsxs(Q,{value:"captive-portal",className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Captive Portal"]}),e.jsxs(Q,{value:"advanced",className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4"}),"Advanced"]})]}),e.jsx(Y,{value:"basic",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"role-name",className:"text-base",children:["Role Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(m,{id:"role-name",value:E,onChange:a=>z(a.target.value),placeholder:"Enter role name",disabled:t?.predefined,className:"max-w-md"}),t?.predefined&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),"Predefined system roles cannot be renamed"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"default-action",className:"text-base",children:"Default Access Control"}),e.jsxs(V,{value:L,onValueChange:a=>K(a),children:[e.jsx(H,{id:"default-action",className:"max-w-xs",children:e.jsx(M,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"allow",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-success"}),e.jsx("span",{children:"Allow - Permit all traffic by default"})]})}),e.jsx(o,{value:"deny",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{children:"Deny - Block all traffic by default"})]})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:L==="allow"?"Traffic is allowed unless explicitly blocked by firewall rules":"Traffic is blocked unless explicitly allowed by firewall rules"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"topology",className:"text-base",children:"VLAN / Topology"}),I.length>0?e.jsxs(V,{value:k||"default",onValueChange:a=>C(a==="default"?null:a),disabled:h,children:[e.jsx(H,{id:"topology",className:"max-w-md",children:e.jsx(M,{placeholder:h?"Loading topologies...":"Select VLAN/Topology"})}),e.jsxs(G,{children:[e.jsx(o,{value:"default",children:e.jsx("span",{className:"text-muted-foreground",children:"Use default network VLAN"})}),I.map(a=>e.jsx(o,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.name}),e.jsxs(x,{variant:"outline",className:"text-xs",children:["VLAN ",a.vlanid]}),a.tagged&&e.jsx(x,{variant:"secondary",className:"text-xs",children:"Tagged"})]})},a.id))]})]}):e.jsx(m,{id:"topology",value:k||"",onChange:a=>C(a.target.value||null),placeholder:"Enter Topology ID (leave blank for default)",className:"max-w-md",disabled:h}),e.jsx("p",{className:"text-xs text-muted-foreground",children:I.length>0?"Assign clients to a specific VLAN/network topology (optional)":"Enter topology ID directly or leave blank for default VLAN"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"default-cos",className:"text-base",children:"Default Class of Service (CoS)"}),y.length>0?e.jsxs(V,{value:P||"default",onValueChange:a=>s(a==="default"?null:a),disabled:h,children:[e.jsx(H,{id:"default-cos",className:"max-w-md",children:e.jsx(M,{placeholder:h?"Loading CoS options...":"Select Class of Service"})}),e.jsxs(G,{children:[e.jsx(o,{value:"default",children:e.jsx("span",{className:"text-muted-foreground",children:"No CoS (default)"})}),y.map(a=>e.jsx(o,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.cosName}),e.jsx(x,{variant:"outline",className:"text-xs",children:a.cosQos.priority!=="notApplicable"?a.cosQos.priority:"None"})]})},a.id))]})]}):e.jsx(m,{id:"default-cos",value:P||"",onChange:a=>s(a.target.value||null),placeholder:"Enter CoS ID (leave blank for default)",className:"max-w-md",disabled:h}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y.length>0?"Assign a Class of Service for QoS and bandwidth management (optional)":"Enter CoS ID directly or leave blank for default (no CoS)"})]})]})}),e.jsxs(Y,{value:"firewall",className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Layer 3 IP Filters"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define IP-based firewall rules for specific ports and protocols"})]}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:Be,className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Add L3 Filter"]})]}),U.length===0?e.jsx(w,{className:"surface-1dp p-6 text-center text-muted-foreground",children:'No Layer 3 filters configured. Click "Add L3 Filter" to create one.'}):e.jsx("div",{className:"space-y-3",children:U.map((a,c)=>e.jsx(w,{className:"surface-1dp p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(l,{className:"text-sm",children:["Filter #",c+1]}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>ze(c),className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",children:e.jsx(ge,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{className:"text-xs",children:"Rule Name"}),e.jsx(m,{value:a.name,onChange:i=>X(c,"name",i.target.value),placeholder:"e.g., Allow DNS",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Action"}),e.jsxs(V,{value:a.action,onValueChange:i=>X(c,"action",i),children:[e.jsx(H,{className:"mt-1",children:e.jsx(M,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"FILTERACTION_ALLOW",children:"Allow"}),e.jsx(o,{value:"FILTERACTION_DENY",children:"Deny"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Protocol"}),e.jsxs(V,{value:a.protocol,onValueChange:i=>X(c,"protocol",i),children:[e.jsx(H,{className:"mt-1",children:e.jsx(M,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"any",children:"Any"}),e.jsx(o,{value:"tcp",children:"TCP"}),e.jsx(o,{value:"udp",children:"UDP"}),e.jsx(o,{value:"icmp",children:"ICMP"}),e.jsx(o,{value:"gre",children:"GRE"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Port"}),e.jsx(m,{value:a.port,onChange:i=>X(c,"port",i.target.value),placeholder:"e.g., dns, http, 80",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"IP Address Range"}),e.jsx(m,{value:a.ipAddressRange,onChange:i=>X(c,"ipAddressRange",i.target.value),placeholder:"0.0.0.0/0",className:"mt-1"})]})]})]})},c))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Layer 7 Application Filters"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Control access to specific applications and application groups"})]}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:Ke,className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Add L7 Filter"]})]}),O.length===0?e.jsx(w,{className:"surface-1dp p-6 text-center text-muted-foreground",children:'No Layer 7 filters configured. Click "Add L7 Filter" to create one.'}):e.jsx("div",{className:"space-y-3",children:O.map((a,c)=>e.jsx(w,{className:"surface-1dp p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(l,{className:"text-sm",children:["Application Filter #",c+1]}),e.jsx(p,{type:"button",variant:"ghost",size:"sm",onClick:()=>We(c),className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",children:e.jsx(ge,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(l,{className:"text-xs",children:"Rule Name"}),e.jsx(m,{value:a.name,onChange:i=>he(c,"name",i.target.value),placeholder:"e.g., Deny Peer to Peer",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"Action"}),e.jsxs(V,{value:a.action,onValueChange:i=>he(c,"action",i),children:[e.jsx(H,{className:"mt-1",children:e.jsx(M,{})}),e.jsxs(G,{children:[e.jsx(o,{value:"FILTERACTION_ALLOW",children:"Allow"}),e.jsx(o,{value:"FILTERACTION_DENY",children:"Deny"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs",children:"App Group ID"}),e.jsx(m,{type:"number",value:a.appGroupId,onChange:i=>he(c,"appGroupId",parseInt(i.target.value)||0),placeholder:"e.g., 7, 12, 22",className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"7=P2P, 12=VPN, 22=Restricted"})]})]})]})},c))})]})]}),e.jsx(Y,{value:"captive-portal",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-1",children:"Captive Portal Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure captive portal redirect and authentication settings"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"cp-redirect",children:"Redirect URL"}),e.jsx(m,{id:"cp-redirect",value:d,onChange:a=>W(a.target.value),placeholder:"https://portal.example.com/login"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"URL to redirect users for captive portal authentication"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"cp-identity",children:"Identity"}),e.jsx(m,{id:"cp-identity",value:Ne,onChange:a=>ie(a.target.value),placeholder:"Portal identity"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"cp-shared-key",children:"Shared Secret Key"}),e.jsx(m,{id:"cp-shared-key",type:"password",value:ve,onChange:a=>de(a.target.value),placeholder:"Shared secret for validation"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"cp-http",children:"Enable HTTP Redirect"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Redirect HTTP traffic to captive portal"})]}),e.jsx(Te,{id:"cp-http",checked:ye,onCheckedChange:oe})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"cp-fqdn",children:"Use Fully Qualified Domain Name"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use FQDN instead of IP address"})]}),e.jsx(Te,{id:"cp-fqdn",checked:we,onCheckedChange:me})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Redirect Ports"}),e.jsx("div",{className:"flex gap-2",children:be.map((a,c)=>e.jsx(x,{variant:"secondary",children:a},c))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Common ports: 80 (HTTP), 443 (HTTPS)"})]})]})}),e.jsx(Y,{value:"advanced",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-1",children:"Advanced Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure features and profile associations"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Features"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Se.map((a,c)=>e.jsx(x,{variant:"outline",children:a},c))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Default: CENTRALIZED-SITE"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Associated Profiles"}),e.jsx(qe,{value:xe.join(`
`),onChange:a=>pe(a.target.value.split(`
`).filter(c=>c.trim())),placeholder:"Enter profile IDs (one per line)",rows:6,className:"font-mono text-sm"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[xe.length," profile(s) associated with this role"]})]})]})})]})}),De=()=>e.jsxs("div",{className:g?"flex justify-end space-x-2 pt-4 border-t":"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:Re,disabled:n,children:"Cancel"}),e.jsx(p,{onClick:Ye,disabled:n||!E.trim(),className:"flex items-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4"}),j?"Save Changes":"Create Role"]})})]}),Ze=()=>e.jsxs("div",{className:"space-y-2 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:j?`Edit Role: ${t?.name}`:"Create New Role"}),h&&e.jsx(re,{className:"h-4 w-4 animate-spin text-muted-foreground"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j?"Modify network policy role configuration and access rules":"Create a new network policy role with custom access rules and settings"})]});return g?u?e.jsxs("div",{className:"space-y-6 p-6 border-t bg-muted/30",children:[Ze(),Fe(),De()]}):null:e.jsx(Pe,{open:u,onOpenChange:a=>!a&&Re(),children:e.jsxs(Ue,{ref:b,className:"surface-2dp max-w-5xl w-[95vw] h-[90vh] p-0 flex flex-col overflow-hidden pointer-events-auto resize",style:{position:"fixed",left:"50%",top:"50%",transform:`translate(calc(-50% + ${F.x}px), calc(-50% + ${F.y}px))`,cursor:N?"grabbing":"auto",minWidth:"800px",minHeight:"600px",maxHeight:"90vh"},onMouseDown:_e,children:[e.jsxs(Oe,{className:"px-6 py-4 border-b","data-drag-handle":!0,style:{cursor:"grab"},children:[e.jsxs(Ve,{className:"flex items-center gap-3",children:[e.jsx(Xe,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(te,{className:"h-5 w-5 text-primary"}),j?`Edit Role: ${t?.name}`:"Create New Role",h&&e.jsx(re,{className:"h-4 w-4 animate-spin text-muted-foreground"})]}),e.jsx(He,{children:j?"Modify network policy role configuration and access rules (drag to move)":"Create a new network policy role with custom access rules and settings (drag to move)"})]}),Fe(),e.jsx(Me,{className:"px-6 py-4 border-t mt-auto",children:De()})]})})}function ds(){const[t,u]=r.useState([]),[A,ee]=r.useState(!0),[g,j]=r.useState(""),[n,se]=r.useState(null),[h,R]=r.useState(!1),[ce,ae]=r.useState("roles"),[F,_]=r.useState(!1),[N,D]=r.useState(!1),[v,B]=r.useState(null),[b,y]=r.useState(null);r.useEffect(()=>{console.log("ðŸ”§ ConfigurePolicy state - isEditDialogOpen:",N,"editingRole:",v?.name||"null")},[N,v]),r.useEffect(()=>{T()},[]);const T=async()=>{ee(!0);try{console.log("ðŸ“¡ Loading network roles from /v3/roles endpoint...");const s=await $.getRoles();u(s||[]),console.log(`âœ“ Loaded ${s.length} network roles:`,s.map(d=>d.name)),s.length===0&&console.warn("âš ï¸ No roles returned from API - check endpoint and authentication")}catch(s){console.error("âŒ Error loading roles:",s),f.error("Failed to load roles",{description:s instanceof Error?s.message:"There was an error loading network policy roles."}),u([])}finally{ee(!1)}},I=t.filter(s=>s.name?.toLowerCase().includes(g.toLowerCase())),ne=s=>{se(s),R(!0)},E=()=>{console.log("ðŸ”§ Create Role button clicked"),B(null),D(!0),console.log("ðŸ”§ Dialog state set to open")},z=s=>{b===s.id?y(null):y(s.id)},L=async s=>{try{const d=b?t.find(W=>W.id===b):v;d?(await $.updateRole(d.id,s),f.success("Role updated",{description:`Successfully updated role "${s.name}"`})):(await $.createRole(s),f.success("Role created",{description:`Successfully created role "${s.name}"`})),await T(),D(!1),B(null),y(null)}catch(d){throw console.error("Error saving role:",d),f.error(roleToUpdate?"Failed to update role":"Failed to create role",{description:d instanceof Error?d.message:"An error occurred"}),d}},K=async s=>{if(s.predefined){f.error("Cannot delete predefined role",{description:"System roles cannot be deleted."});return}if(!s.canDelete){f.error("Cannot delete role",{description:"This role is in use and cannot be deleted."});return}if(confirm(`Are you sure you want to delete the role "${s.name}"? This action cannot be undone.`))try{_(!0),await $.deleteRole(s.id),f.success("Role deleted",{description:`Successfully deleted role "${s.name}"`}),await T()}catch(d){console.error("Error deleting role:",d),f.error("Failed to delete role",{description:d instanceof Error?d.message:"An error occurred"})}finally{_(!1)}},k=(s,d)=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx(es,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg mb-2",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-md",children:d})]}),C=s=>(s.l2Filters?.length||0)+(s.l3Filters?.length||0)+(s.l3SrcDestFilters?.length||0)+(s.l7Filters?.length||0),P=s=>!!(s.cpRedirect&&s.cpRedirect.trim()!=="");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl mb-1",children:"Policy Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage network roles, access policies, and firewall rules"})]}),e.jsxs(p,{onClick:E,className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Create Role"]})]}),e.jsx(w,{className:"surface-2dp",children:e.jsxs(Le,{value:ce,onValueChange:ae,className:"w-full",children:[e.jsx("div",{className:"border-b border-border px-6 pt-6",children:e.jsxs(ke,{className:"bg-transparent border-b-0 h-auto p-0 space-x-6",children:[e.jsxs(Q,{value:"roles",className:"bg-transparent border-b-2 border-transparent data-[state=active]:border-primary rounded-none px-0 pb-3",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Network Roles"]}),e.jsxs(Q,{value:"firewall",className:"bg-transparent border-b-2 border-transparent data-[state=active]:border-primary rounded-none px-0 pb-3",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Firewall Rules"]})]})}),e.jsxs(Y,{value:"roles",className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search network roles...",value:g,onChange:s=>j(s.target.value),className:"pl-10"})]}),e.jsxs(p,{variant:"outline",onClick:T,disabled:A,className:"flex items-center gap-2",children:[e.jsx(re,{className:`h-4 w-4 ${A?"animate-spin":""}`}),"Refresh"]})]}),A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(re,{className:"h-8 w-8 animate-spin text-primary"})}):I.length===0?k(g?"No roles found":"No roles configured",g?"Try adjusting your search criteria":"Network roles define access policies and security rules"):e.jsx("div",{className:"space-y-3",children:I.map(s=>e.jsxs("div",{children:[e.jsx(w,{className:`surface-1dp p-4 transition-all cursor-pointer ${b===s.id?"ring-2 ring-primary":"hover:surface-2dp"}`,onClick:()=>z(s),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[e.jsx("h3",{className:"font-medium",children:s.name}),s.predefined&&e.jsxs(x,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),"System"]}),e.jsx(x,{variant:s.defaultAction==="allow"?"default":"destructive",className:"flex items-center gap-1",children:s.defaultAction==="allow"?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-3 w-3"}),"Allow"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-3 w-3"}),"Deny"]})}),P(s)&&e.jsxs(x,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3"}),"Captive Portal"]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground flex-wrap",children:[C(s)>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3"}),C(s)," filter rule(s)"]}),s.profiles&&s.profiles.length>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"h-3 w-3"}),s.profiles.length," profile(s)"]}),s.topology&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3"}),"Custom VLAN"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[!s.canEdit&&e.jsx(x,{variant:"outline",className:"text-xs",children:"Read-only"}),s.features&&s.features.length>0&&e.jsx("span",{className:"text-xs text-muted-foreground",children:s.features.join(", ")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:d=>{d.stopPropagation(),ne(s)},className:"h-8 w-8 p-0",title:"View details",children:e.jsx(Ie,{className:"h-4 w-4"})}),s.canDelete&&!s.predefined&&e.jsx(p,{variant:"ghost",size:"sm",onClick:d=>{d.stopPropagation(),K(s)},disabled:F,className:"h-8 w-8 p-0 text-destructive hover:text-destructive hover:bg-destructive/10",title:"Delete role",children:e.jsx(ge,{className:"h-4 w-4"})})]})]})}),b===s.id&&e.jsx(Ee,{role:s,isOpen:!0,onClose:()=>y(null),onSave:L,isInline:!0})]},s.id))})]}),e.jsx(Y,{value:"firewall",className:"p-6",children:k("Firewall Rules Management","Advanced firewall rule configuration will be available in a future update. Use the Network Roles tab to view roles with firewall filters.")})]})}),e.jsx(Pe,{open:h,onOpenChange:R,children:e.jsxs(Ue,{className:"surface-2dp max-w-[95vw] sm:max-w-[90vw] lg:max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Oe,{children:[e.jsxs(Ve,{className:"flex items-center gap-3",children:[n?.name,n?.predefined&&e.jsxs(x,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),"System Role"]})]}),e.jsx(He,{children:"Network policy role configuration and details"})]}),n&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Role ID"}),e.jsx("p",{className:"text-sm font-mono mt-1",children:n.id})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Default Action"}),e.jsx("div",{className:"mt-1",children:e.jsx(x,{variant:n.defaultAction==="allow"?"default":"destructive",children:n.defaultAction})})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Editable"}),e.jsx("p",{className:"text-sm mt-1",children:n.canEdit?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Can Delete"}),e.jsx("p",{className:"text-sm mt-1",children:n.canDelete?"Yes":"No"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Firewall Rules"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"L2 Filters"}),e.jsxs("p",{className:"text-sm mt-1",children:[n.l2Filters?.length||0," rule(s)"]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"L3 Filters"}),e.jsxs("p",{className:"text-sm mt-1",children:[n.l3Filters?.length||0," rule(s)"]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"L3 Src/Dest Filters"}),e.jsxs("p",{className:"text-sm mt-1",children:[n.l3SrcDestFilters?.length||0," rule(s)"]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"L7 Filters"}),e.jsxs("p",{className:"text-sm mt-1",children:[n.l7Filters?.length||0," rule(s)"]})]})]}),n.l3Filters&&n.l3Filters.length>0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(l,{children:"L3 Filter Rules"}),e.jsx("div",{className:"space-y-2",children:n.l3Filters.map((s,d)=>e.jsx(w,{className:"surface-1dp p-3",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground grid grid-cols-2 gap-2",children:[e.jsxs("span",{children:["Action: ",s.action]}),e.jsxs("span",{children:["Protocol: ",s.protocol]}),e.jsxs("span",{children:["Port: ",s.port]}),e.jsxs("span",{children:["IP Range: ",s.ipAddressRange]})]})]})},d))})]}),n.l7Filters&&n.l7Filters.length>0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(l,{children:"L7 Application Filters"}),e.jsx("div",{className:"space-y-2",children:n.l7Filters.map((s,d)=>e.jsx(w,{className:"surface-1dp p-3",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Action: ",s.action]}),s.appGroupId&&e.jsxs("span",{className:"ml-4",children:["Group ID: ",s.appGroupId]})]})]})},d))})]})]}),P(n)&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Captive Portal Configuration"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Redirect URL"}),e.jsx("p",{className:"text-sm mt-1 break-all font-mono",children:n.cpRedirect})]}),n.cpIdentity&&e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Identity"}),e.jsx("p",{className:"text-sm mt-1",children:n.cpIdentity})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"HTTP Enabled"}),e.jsx("p",{className:"text-sm mt-1",children:n.cpHttp?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Use FQDN"}),e.jsx("p",{className:"text-sm mt-1",children:n.cpUseFQDN?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Redirect Ports"}),e.jsx("p",{className:"text-sm mt-1",children:n.cpRedirectPorts?.join(", ")||"None"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Network Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Topology ID"}),e.jsx("p",{className:"text-sm mt-1 font-mono",children:n.topology||"Default"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Default CoS"}),e.jsx("p",{className:"text-sm mt-1 font-mono",children:n.defaultCos||"None"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Features"}),e.jsx("p",{className:"text-sm mt-1",children:n.features?.join(", ")||"None"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:"Associated Profiles"}),e.jsxs("p",{className:"text-sm mt-1",children:[n.profiles?.length||0," profile(s)"]})]})]})]})]}),e.jsx(Me,{children:e.jsx(p,{variant:"outline",onClick:()=>R(!1),children:"Close"})})]})}),e.jsx(Ee,{role:v,isOpen:N,onClose:()=>{D(!1),B(null)},onSave:L})]})}export{ds as ConfigurePolicy};
