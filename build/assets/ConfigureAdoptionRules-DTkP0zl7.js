import{j as e}from"./vendor-ui-CO0mBmim.js";import{a as i}from"./vendor-react-BQC692LR.js";import{a as f,w as r,C as k,B as d,I as A,m as y,n as w,o as S,p as R,q as p,e as W,T as Ce,i as Ae,j as Z,k as q,L as m}from"./index-CrdvL8SR.js";import{D as ye,a as we,b as Se,c as Re,d as Te,e as Ee}from"./dialog-BqYeg193.js";import{S as ee}from"./switch-iy-vimzq.js";import{T as De,a as ke,b as se,c as g,d as Pe,e as j}from"./table-BR47Ry2r.js";import{ac as P,P as Fe,J as le,as as Ie,at as Le,M as Ve,k as Me,N as Oe,f as Be,b4 as ze,a0 as U,aX as Ge}from"./vendor-icons-DmoIqCnf.js";import"./vendor-charts-CCS-1Xlq.js";const ae=[{value:"macAddress",label:"MAC Address"},{value:"serialNumber",label:"Serial Number"},{value:"model",label:"Device Model"},{value:"manufacturer",label:"Manufacturer"},{value:"location",label:"Location"},{value:"apName",label:"AP Name"},{value:"ipSubnet",label:"IP Subnet"}],We=[{value:"equals",label:"Equals"},{value:"contains",label:"Contains"},{value:"startsWith",label:"Starts With"},{value:"endsWith",label:"Ends With"},{value:"matches",label:"Matches (Regex)"},{value:"inRange",label:"In Range"}],te=[{value:"assignSite",label:"Assign to Site",icon:Ve},{value:"assignProfile",label:"Assign Profile",icon:Me},{value:"assignVlan",label:"Assign VLAN",icon:Oe},{value:"assignRole",label:"Assign Role",icon:Be},{value:"setTags",label:"Set Tags",icon:le}];function Xe(){const[c,h]=i.useState([]),[$,H]=i.useState([]),[ie,Y]=i.useState(!0),[N,ne]=i.useState(""),[v,re]=i.useState("all"),[de,T]=i.useState(!1),[o,E]=i.useState(!1),[n,ce]=i.useState(null),[oe,F]=i.useState("general"),[I,L]=i.useState(""),[_,V]=i.useState(""),[J,M]=i.useState(!0),[u,b]=i.useState([]),[x,C]=i.useState([]);i.useEffect(()=>{ue(),me()},[]);const ue=async()=>{Y(!0);try{const s=await f.getAdoptionRules();if(!s||s.length===0){const a=[{id:"1",name:"Building A Access Points",description:"Automatically assign all Building A APs to the correct site",enabled:!0,priority:1,conditions:[{id:"c1",field:"apName",operator:"startsWith",value:"BLDG-A-"}],actions:[{id:"a1",type:"assignSite",value:"site-001",label:"Building A - Main Campus"}],matchCount:24,lastMatched:new Date().toISOString(),createdAt:"2025-01-10T10:00:00Z",modifiedAt:"2025-01-15T14:30:00Z"},{id:"2",name:"Guest Network Devices",description:"Assign guest VLAN to devices matching guest patterns",enabled:!0,priority:2,conditions:[{id:"c2",field:"apName",operator:"contains",value:"GUEST"}],actions:[{id:"a2",type:"assignVlan",value:"100",label:"VLAN 100 (Guest)"}],matchCount:12,lastMatched:new Date().toISOString(),createdAt:"2025-01-12T09:00:00Z",modifiedAt:"2025-01-12T09:00:00Z"},{id:"3",name:"Corporate APs by MAC Range",description:"Assign corporate profile based on MAC address range",enabled:!1,priority:3,conditions:[{id:"c3",field:"macAddress",operator:"startsWith",value:"AA:BB:CC"}],actions:[{id:"a3",type:"assignProfile",value:"corp-standard",label:"Corporate Standard Profile"},{id:"a4",type:"setTags",value:"corporate,managed",label:"Tags: corporate, managed"}],matchCount:0,createdAt:"2025-01-08T16:00:00Z",modifiedAt:"2025-01-14T11:20:00Z"}];h(a)}else h(s)}catch(s){console.error("Error loading adoption rules:",s),r.error("Failed to load adoption rules")}finally{Y(!1)}},me=async()=>{try{const s=await f.makeAuthenticatedRequest("/v1/sites",{method:"GET"});if(!s.ok)throw new Error("Failed to load sites");const a=await s.json(),t=a.items||a.sites||a||[];H(t.map(l=>({id:l.id||l.siteId,name:l.name||l.siteName||"Unnamed Site"})))}catch(s){console.error("Error loading sites:",s),H([{id:"site-001",name:"Building A - Main Campus"},{id:"site-002",name:"Building B - Research Lab"},{id:"site-003",name:"Building C - Admin"}])}},X=()=>{D(),T(!0)},he=s=>{ce(s),L(s.name),V(s.description),M(s.enabled),b([...s.conditions]),C([...s.actions]),F("general"),E(!0)},xe=async s=>{if(confirm("Are you sure you want to delete this adoption rule?"))try{await f.deleteAdoptionRule(s),h(c.filter(a=>a.id!==s)),r.success("Adoption rule deleted successfully")}catch(a){console.error("Error deleting rule:",a),r.error(a instanceof Error?a.message:"Failed to delete adoption rule")}},pe=async(s,a)=>{try{await f.toggleAdoptionRule(s,a),h(c.map(t=>t.id===s?{...t,enabled:a}:t)),r.success(`Rule ${a?"enabled":"disabled"} successfully`)}catch(t){console.error("Error toggling rule:",t),r.error(t instanceof Error?t.message:"Failed to update rule status")}},K=(s,a)=>{const t=c.findIndex(G=>G.id===s);if(t===-1||a==="up"&&t===0||a==="down"&&t===c.length-1)return;const l=[...c],Q=a==="up"?t-1:t+1;[l[t],l[Q]]=[l[Q],l[t]],l.forEach((G,be)=>{G.priority=be+1}),h(l),r.success("Rule priority updated")},D=()=>{L(""),V(""),M(!0),b([]),C([]),F("general")},ge=async()=>{if(!I.trim()){r.error("Please enter a rule name");return}if(u.length===0){r.error("Please add at least one condition");return}if(x.length===0){r.error("Please add at least one action");return}try{const s={id:o&&n?n.id:`rule-${Date.now()}`,name:I,description:_,enabled:J,priority:o&&n?n.priority:c.length+1,conditions:u,actions:x,matchCount:o&&n?n.matchCount:0,lastMatched:o&&n?n.lastMatched:void 0,createdAt:o&&n?n.createdAt:new Date().toISOString(),modifiedAt:new Date().toISOString()};if(o&&n)await f.updateAdoptionRule(n.id,s),h(c.map(a=>a.id===n.id?s:a)),r.success("Adoption rule updated successfully");else{const a=await f.createAdoptionRule(s);h([...c,a||s]),r.success("Adoption rule created successfully")}T(!1),E(!1),D()}catch(s){console.error("Error saving rule:",s),r.error("Failed to save adoption rule")}},je=()=>{const s={id:`cond-${Date.now()}`,field:"macAddress",operator:"equals",value:""};b([...u,s])},O=(s,a)=>{b(u.map(t=>t.id===s?{...t,...a}:t))},ve=s=>{b(u.filter(a=>a.id!==s))},fe=()=>{const s={id:`action-${Date.now()}`,type:"assignSite",value:"",label:""};C([...x,s])},B=(s,a)=>{C(x.map(t=>t.id===s?{...t,...a}:t))},Ne=s=>{C(x.filter(a=>a.id!==s))},z=c.filter(s=>{const a=s.name.toLowerCase().includes(N.toLowerCase())||s.description.toLowerCase().includes(N.toLowerCase()),t=v==="all"||v==="enabled"&&s.enabled||v==="disabled"&&!s.enabled;return a&&t});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(k,{className:"bg-card border-border",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-card-foreground mb-2",children:"Adoption Rules"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure automatic device adoption rules based on device properties"})]}),e.jsxs(d,{onClick:X,className:"bg-primary hover:bg-primary/90",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Create Rule"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(A,{placeholder:"Search rules...",value:N,onChange:s=>ne(s.target.value),className:"pl-10"})]}),e.jsxs(y,{value:v,onValueChange:re,children:[e.jsx(w,{className:"w-[180px]",children:e.jsx(S,{placeholder:"Filter by status"})}),e.jsxs(R,{children:[e.jsx(p,{value:"all",children:"All Rules"}),e.jsx(p,{value:"enabled",children:"Enabled"}),e.jsx(p,{value:"disabled",children:"Disabled"})]})]})]})]})}),e.jsx(k,{className:"bg-card border-border",children:e.jsx("div",{className:"p-6",children:ie?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"Loading adoption rules..."}):z.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:N||v!=="all"?"No rules match your filters":"No adoption rules configured yet"}),!N&&v==="all"&&e.jsxs(d,{onClick:X,variant:"outline",className:"mt-4",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Create Your First Rule"]})]}):e.jsxs(De,{children:[e.jsx(ke,{children:e.jsxs(se,{children:[e.jsx(g,{className:"w-12",children:"Priority"}),e.jsx(g,{className:"w-12",children:"Status"}),e.jsx(g,{children:"Rule Name"}),e.jsx(g,{children:"Conditions"}),e.jsx(g,{children:"Actions"}),e.jsx(g,{className:"text-right",children:"Matched"}),e.jsx(g,{className:"text-right w-32",children:"Actions"})]})}),e.jsx(Pe,{children:z.map((s,a)=>e.jsxs(se,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>K(s.id,"up"),disabled:a===0,className:"h-5 w-5 p-0",children:e.jsx(Ie,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-center text-xs",children:s.priority}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>K(s.id,"down"),disabled:a===z.length-1,className:"h-5 w-5 p-0",children:e.jsx(Le,{className:"h-3 w-3"})})]})}),e.jsx(j,{children:e.jsx(ee,{checked:s.enabled,onCheckedChange:t=>pe(s.id,t)})}),e.jsx(j,{children:e.jsxs("div",{children:[e.jsx("div",{className:"text-card-foreground",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.description})]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-1",children:s.conditions.map(t=>e.jsxs(W,{variant:"outline",className:"text-xs",children:[ae.find(l=>l.value===t.field)?.label," ",t.operator,' "',t.value,'"']},t.id))})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-1",children:s.actions.map(t=>e.jsxs(W,{variant:"secondary",className:"text-xs",children:[te.find(l=>l.value===t.type)?.label,": ",t.label||t.value]},t.id))})}),e.jsx(j,{className:"text-right",children:e.jsx("div",{className:"text-sm",children:s.matchCount>0?e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:[s.matchCount," devices"]}):e.jsx("span",{className:"text-muted-foreground",children:"0 devices"})})}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>he(s),children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>xe(s.id),className:"text-destructive hover:text-destructive",children:e.jsx(U,{className:"h-4 w-4"})})]})})]},s.id))})]})})}),e.jsx(ye,{open:de||o,onOpenChange:s=>{s||(T(!1),E(!1),D())},children:e.jsxs(we,{className:"max-w-[95vw] sm:max-w-[90vw] lg:max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Se,{children:[e.jsx(Re,{children:o?"Edit Adoption Rule":"Create Adoption Rule"}),e.jsx(Te,{children:"Configure conditions and actions for automatic device adoption"})]}),e.jsxs(Ce,{value:oe,onValueChange:F,children:[e.jsxs(Ae,{className:"grid w-full grid-cols-3",children:[e.jsx(Z,{value:"general",children:"General"}),e.jsx(Z,{value:"conditions",children:"Conditions"}),e.jsx(Z,{value:"actions",children:"Actions"})]}),e.jsxs(q,{value:"general",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"name",children:"Rule Name"}),e.jsx(A,{id:"name",placeholder:"Enter rule name",value:I,onChange:s=>L(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(A,{id:"description",placeholder:"Enter rule description",value:_,onChange:s=>V(s.target.value)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{id:"enabled",checked:J,onCheckedChange:M}),e.jsx(m,{htmlFor:"enabled",children:"Enable this rule"})]})]}),e.jsxs(q,{value:"conditions",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add conditions that devices must match for this rule to apply"}),e.jsxs(d,{onClick:je,size:"sm",variant:"outline",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add Condition"]})]}),u.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'No conditions added yet. Click "Add Condition" to start.'}):e.jsx("div",{className:"space-y-3",children:u.map((s,a)=>e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ge,{className:"h-5 w-5 text-muted-foreground mt-2"}),e.jsxs("div",{className:"flex-1 grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-xs",children:"Field"}),e.jsxs(y,{value:s.field,onValueChange:t=>O(s.id,{field:t}),children:[e.jsx(w,{children:e.jsx(S,{})}),e.jsx(R,{children:ae.map(t=>e.jsx(p,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-xs",children:"Operator"}),e.jsxs(y,{value:s.operator,onValueChange:t=>O(s.id,{operator:t}),children:[e.jsx(w,{children:e.jsx(S,{})}),e.jsx(R,{children:We.map(t=>e.jsx(p,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-xs",children:"Value"}),e.jsx(A,{value:s.value,onChange:t=>O(s.id,{value:t.target.value}),placeholder:"Enter value"})]})]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>ve(s.id),className:"mt-6",children:e.jsx(U,{className:"h-4 w-4 text-destructive"})})]}),a<u.length-1&&e.jsx("div",{className:"flex items-center justify-center mt-2",children:e.jsx(W,{variant:"outline",className:"text-xs",children:"AND"})})]},s.id))})]}),e.jsxs(q,{value:"actions",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define actions to take when a device matches this rule"}),e.jsxs(d,{onClick:fe,size:"sm",variant:"outline",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add Action"]})]}),x.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'No actions added yet. Click "Add Action" to start.'}):e.jsx("div",{className:"space-y-3",children:x.map(s=>e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-xs",children:"Action Type"}),e.jsxs(y,{value:s.type,onValueChange:a=>B(s.id,{type:a}),children:[e.jsx(w,{children:e.jsx(S,{})}),e.jsx(R,{children:te.map(a=>e.jsx(p,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-xs",children:s.type==="assignSite"?"Site":s.type==="assignProfile"?"Profile":s.type==="assignVlan"?"VLAN ID":s.type==="assignRole"?"Role":"Tags"}),s.type==="assignSite"?e.jsxs(y,{value:s.value,onValueChange:a=>{const t=$.find(l=>l.id===a);B(s.id,{value:a,label:t?.name})},children:[e.jsx(w,{children:e.jsx(S,{placeholder:"Select site"})}),e.jsx(R,{children:$.map(a=>e.jsx(p,{value:a.id,children:a.name},a.id))})]}):e.jsx(A,{value:s.value,onChange:a=>B(s.id,{value:a.target.value,label:a.target.value}),placeholder:s.type==="assignVlan"?"Enter VLAN ID":s.type==="setTags"?"Enter tags (comma-separated)":"Enter value"})]})]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>Ne(s.id),className:"mt-6",children:e.jsx(U,{className:"h-4 w-4 text-destructive"})})]})},s.id))})]})]}),e.jsxs(Ee,{children:[e.jsx(d,{variant:"outline",onClick:()=>{T(!1),E(!1),D()},children:"Cancel"}),e.jsx(d,{onClick:ge,className:"bg-primary hover:bg-primary/90",children:o?"Update Rule":"Create Rule"})]})]})})]})}export{Xe as ConfigureAdoptionRules};
