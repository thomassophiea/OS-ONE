const l={SITE_ASSIGNMENTS:"wlan_site_assignments",PROFILE_ASSIGNMENTS:"wlan_profile_assignments"};class o{getAllSiteAssignments(){try{const e=localStorage.getItem(l.SITE_ASSIGNMENTS);return e?JSON.parse(e):{}}catch(e){return console.error("[AssignmentStorage] Error reading site assignments:",e),{}}}getAllProfileAssignments(){try{const e=localStorage.getItem(l.PROFILE_ASSIGNMENTS);return e?JSON.parse(e):{}}catch(e){return console.error("[AssignmentStorage] Error reading profile assignments:",e),{}}}saveAllSiteAssignments(e){try{localStorage.setItem(l.SITE_ASSIGNMENTS,JSON.stringify(e))}catch(s){throw console.error("[AssignmentStorage] Error saving site assignments:",s),s instanceof DOMException&&s.name==="QuotaExceededError"?new Error("Storage quota exceeded. Please clear some data."):s}}saveAllProfileAssignments(e){try{localStorage.setItem(l.PROFILE_ASSIGNMENTS,JSON.stringify(e))}catch(s){throw console.error("[AssignmentStorage] Error saving profile assignments:",s),s instanceof DOMException&&s.name==="QuotaExceededError"?new Error("Storage quota exceeded. Please clear some data."):s}}getSiteAssignmentKey(e,s){return`${e}_${s}`}getProfileAssignmentKey(e,s){return`${e}_${s}`}saveWLANSiteAssignment(e){console.log("[AssignmentStorage] Saving site assignment:",e);const s=this.getAllSiteAssignments(),t=this.getSiteAssignmentKey(e.wlanId,e.siteId);s[t]={...e,lastModified:new Date().toISOString()},this.saveAllSiteAssignments(s)}getWLANSiteAssignments(e){const s=this.getAllSiteAssignments();return Object.values(s).filter(t=>t.wlanId===e)}getSiteAssignment(e,s){const t=this.getAllSiteAssignments(),n=this.getSiteAssignmentKey(e,s);return t[n]||null}deleteSiteAssignment(e,s){const t=this.getAllSiteAssignments(),n=this.getSiteAssignmentKey(e,s);delete t[n],this.saveAllSiteAssignments(t)}deleteWLANSiteAssignments(e){const s=this.getAllSiteAssignments(),t=Object.fromEntries(Object.entries(s).filter(([n,i])=>i.wlanId!==e));this.saveAllSiteAssignments(t)}saveWLANProfileAssignment(e){console.log("[AssignmentStorage] Saving profile assignment:",e);const s=this.getAllProfileAssignments(),t=this.getProfileAssignmentKey(e.wlanId,e.profileId);s[t]={...e,lastReconciled:e.lastReconciled||new Date().toISOString()},this.saveAllProfileAssignments(s)}saveWLANProfileAssignmentsBatch(e){console.log(`[AssignmentStorage] Batch saving ${e.length} profile assignments`);const s=this.getAllProfileAssignments();for(const t of e){const n=this.getProfileAssignmentKey(t.wlanId,t.profileId);s[n]={...t,lastReconciled:t.lastReconciled||new Date().toISOString()}}this.saveAllProfileAssignments(s)}getWLANProfileAssignments(e){const s=this.getAllProfileAssignments();return Object.values(s).filter(t=>t.wlanId===e)}getProfileAssignment(e,s){const t=this.getAllProfileAssignments(),n=this.getProfileAssignmentKey(e,s);return t[n]||null}updateProfileAssignmentActualState(e,s,t,n){const i=this.getProfileAssignment(e,s);if(!i){console.warn(`[AssignmentStorage] Profile assignment not found: ${e}_${s}`);return}const r={...i,actualState:t,mismatch:n,lastReconciled:new Date().toISOString()};this.saveWLANProfileAssignment(r)}updateProfileAssignmentSyncStatus(e,s,t,n){const i=this.getProfileAssignment(e,s);if(!i){console.warn(`[AssignmentStorage] Profile assignment not found: ${e}_${s}`);return}const r={...i,syncStatus:t,syncError:n,lastReconciled:new Date().toISOString()};this.saveWLANProfileAssignment(r)}deleteProfileAssignment(e,s){const t=this.getAllProfileAssignments(),n=this.getProfileAssignmentKey(e,s);delete t[n],this.saveAllProfileAssignments(t)}deleteWLANProfileAssignments(e){const s=this.getAllProfileAssignments(),t=Object.fromEntries(Object.entries(s).filter(([n,i])=>i.wlanId!==e));this.saveAllProfileAssignments(t)}getAllWLANAssignments(e){return{siteAssignments:this.getWLANSiteAssignments(e),profileAssignments:this.getWLANProfileAssignments(e)}}deleteAllWLANAssignments(e){console.log(`[AssignmentStorage] Deleting all assignments for WLAN: ${e}`),this.deleteWLANSiteAssignments(e),this.deleteWLANProfileAssignments(e)}getAllTrackedWLANs(){const e=this.getAllSiteAssignments(),s=this.getAllProfileAssignments(),t=new Set;return Object.values(e).forEach(n=>t.add(n.wlanId)),Object.values(s).forEach(n=>t.add(n.wlanId)),Array.from(t)}clearAll(){console.warn("[AssignmentStorage] Clearing all assignment data"),localStorage.removeItem(l.SITE_ASSIGNMENTS),localStorage.removeItem(l.PROFILE_ASSIGNMENTS)}getStorageStats(){const e=this.getAllSiteAssignments(),s=this.getAllProfileAssignments();return{siteAssignmentCount:Object.keys(e).length,profileAssignmentCount:Object.keys(s).length,trackedWLANCount:this.getAllTrackedWLANs().length}}}const A=new o;export{A as assignmentStorageService};
